# Railway Configuration
# Last Update: 2026-01-01 00:20:00 UTC - Fixed version.json generation
[build]
builder = "nixpacks"

[build.nixpacksPlan]
phases.setup.nixPkgs = ["nodejs"]
phases.install.cmds = [
  "npm ci --no-cache",
  "echo 'Build started at:' $(date -u)"
]
phases.build.cmds = [
  "rm -rf node_modules/.vite build dist .cache",
  "echo 'Forcing clean build - clearing all caches'",
  "npm run build",
  "echo 'Version generated by build script:'",
  "cat build/version.json",
  "ls -la build/ | head -20",
  "echo 'Build completed at:' $(date -u)"
]

[deploy]
startCommand = "node server.js"
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 10
